---
// LogosGrid component for convenios
---

<section class="section__container portfolio__container" id="convenios">
  <h2 class="section__img">Nuestros convenios</h2>
  <div class="portfolio__grid">
    <!-- Primeras 6 imágenes con carga inmediata (above the fold) con fetchpriority -->
    <div class="convenio__card">
      <picture>
        <source srcset="/casur.webp" type="image/webp">
        <img src="/casur.jpg" alt="CASUR - Caja de Sueldos de Retiro de la Policía Nacional" width="182" height="121" fetchpriority="high" loading="eager">
      </picture>
    </div>
    <div class="convenio__card">
      <picture>
        <source srcset="/cremil.webp" type="image/webp">
        <img src="/cremil.jpg" alt="CREMIL - Caja de Retiro de las Fuerzas Militares" width="182" height="121" fetchpriority="high" loading="eager">
      </picture>
    </div>
    <div class="convenio__card">
      <picture>
        <source srcset="/colpensiones.webp" type="image/webp">
        <img src="/colpensiones.jpg" alt="Colpensiones - Administradora Colombiana de Pensiones" width="182" height="121" fetchpriority="high" loading="eager">
      </picture>
    </div>
    <div class="convenio__card">
      <picture>
        <source srcset="/fopep.webp" type="image/webp">
        <img src="/fopep.jpg" alt="FOPEP - Fondo de Prestaciones Económicas Cesantías y Pensiones" width="182" height="121">
      </picture>
    </div>
    <div class="convenio__card">
      <picture>
        <source srcset="/fomag.webp" type="image/webp">
        <img src="/fomag.jpg" alt="FOMAG - Fondo Nacional del Magisterio" width="182" height="121">
      </picture>
    </div>
    <div class="convenio__card">
      <picture>
        <source srcset="/armenia.webp" type="image/webp">
        <img src="/armenia.jpg" alt="Gobernación de Armenia - Convenio Crédito de Libranza" width="182" height="121">
      </picture>
    </div>
    
    <!-- Resto de imágenes con lazy loading optimizado -->
    <div class="convenio__card lazy-load">
      <picture>
        <source data-srcset="/tolima.webp" type="image/webp">
        <img data-src="/tolima.jpg" alt="Gobernación del Tolima - Convenio Crédito de Libranza" width="182" height="121" class="lazy-img">
      </picture>
    </div>
    <div class="convenio__card lazy-load">
      <picture>
        <source data-srcset="/proteccion.webp" type="image/webp">
        <img data-src="/proteccion.jpg" alt="Protección - Administradora de Fondos de Pensiones" width="182" height="121" class="lazy-img">
      </picture>
    </div>
    <div class="convenio__card lazy-load">
      <picture>
        <source data-srcset="/colfondos.webp" type="image/webp">
        <img data-src="/colfondos.jpg" alt="Colfondos - Administradora de Fondos de Pensiones" width="182" height="121" class="lazy-img">
      </picture>
    </div>
    <div class="convenio__card lazy-load">
      <picture>
        <source data-srcset="/positiva.webp" type="image/webp">
        <img data-src="/positiva.jpg" alt="Positiva Compañía de Seguros - ARL" width="182" height="121" class="lazy-img">
      </picture>
    </div>
    <div class="convenio__card lazy-load">
      <picture>
        <source data-srcset="/porvenir.webp" type="image/webp">
        <img data-src="/porvenir.jpg" alt="Porvenir - Administradora de Fondos de Pensiones" width="182" height="121" class="lazy-img">
      </picture>
    </div>
    <div class="convenio__card lazy-load">
      <picture>
        <source data-srcset="/mafre.webp" type="image/webp">
        <img data-src="/mafre.jpg" alt="MAPFRE - Compañía de Seguros" width="182" height="121" class="lazy-img">
      </picture>
    </div>
    <div class="convenio__card lazy-load">
      <picture>
        <source data-srcset="/sura.webp" type="image/webp">
        <img data-src="/sura.jpg" alt="SURA - Administradora de Fondos de Pensiones" width="182" height="121" class="lazy-img">
      </picture>
    </div>
    <div class="convenio__card lazy-load">
      <picture>
        <source data-srcset="/alfa.webp" type="image/webp">
        <img data-src="/alfa.jpg" alt="Old Mutual - Administradora de Fondos de Pensiones" width="182" height="121" class="lazy-img">
      </picture>
    </div>
    <div class="convenio__card lazy-load">
      <picture>
        <source data-srcset="/skandia.webp" type="image/webp">
        <img data-src="/skandia.jpg" alt="Skandia - Administradora de Fondos de Pensiones" width="182" height="121" class="lazy-img">
      </picture>
    </div>
    <div class="convenio__card lazy-load">
      <picture>
        <source data-srcset="/asulado.webp" type="image/webp">
        <img data-src="/asulado.jpg" alt="ASULADO - Asociación de Usuarios de la Defensoría del Pueblo" width="182" height="121" class="lazy-img">
      </picture>
    </div>
    <div class="convenio__card lazy-load">
      <picture>
        <source data-srcset="/antioquia.webp" type="image/webp">
        <img data-src="/antioquia.jpg" alt="Gobernación de Antioquia" width="182" height="121" class="lazy-img">
      </picture>
    </div>
    <div class="convenio__card lazy-load">
      <picture>
        <source data-srcset="/medellin.webp" type="image/webp">
        <img data-src="/medellin.jpg" alt="Alcaldía de Medellín" width="182" height="121" class="lazy-img">
      </picture>
    </div>
    <div class="convenio__card lazy-load">
      <picture>
        <source data-srcset="/huila.webp" type="image/webp">
        <img data-src="/huila.jpg" alt="Gobernación del Huila" width="182" height="121" class="lazy-img">
      </picture>
    </div>
    <div class="convenio__card lazy-load">
      <picture>
        <source data-srcset="/cartagena.webp" type="image/webp">
        <img data-src="/cartagena.jpg" alt="Alcaldía de Cartagena" width="182" height="121" class="lazy-img">
      </picture>
    </div>
  </div>
  <div class="portfolio__banner">
    <div class="portfolio__banner__card">
      <span><i class="ri-earth-line"></i></span>
      <h4>Cobertura a nivel Nacional</h4>
      <p>Toda Colombia</p>
    </div>
    <div class="portfolio__banner__card">
      <span><i class="ri-discuss-line"></i></span>
      <h4>100% digital</h4>
      <p>En pocos pasos</p>
    </div>
    <div class="portfolio__banner__card">
      <span><i class="ri-calendar-check-line"></i></span>
      <h4>Desde 12 hasta 144 meses</h4>
      <p>Eliges tu plazo</p>
    </div>
  </div>
</section>

<script>
  // Optimización de carga diferida con IntersectionObserver
  const lazyLoadImages = () => {
    const lazyCards = document.querySelectorAll('.convenio__card.lazy-load');
    
    const loadPicture = (picture: HTMLPictureElement) => {
      const source = picture.querySelector('source');
      const img = picture.querySelector('img');
      if (source && source.dataset.srcset) {
        source.srcset = source.dataset.srcset;
        source.removeAttribute('data-srcset');
      }
      if (img && img.dataset.src) {
        img.src = img.dataset.src;
        img.removeAttribute('data-src');
        img.classList.remove('lazy-img');
      }
    };
    
    if ('IntersectionObserver' in window) {
      const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const picture = entry.target.querySelector('picture');
            if (picture) loadPicture(picture);
            observer.unobserve(entry.target);
          }
        });
      }, {
        rootMargin: '200px', // Carga imágenes cuando están a 200px de entrar en viewport
        threshold: 0.01
      });
      
      lazyCards.forEach(card => imageObserver.observe(card));
    } else {
      // Fallback simple para navegadores sin soporte para IntersectionObserver
      const lazyLoadFallback = () => {
        const scrollTop = window.pageYOffset;
        lazyCards.forEach(card => {
          if ((card as HTMLElement).offsetTop < (window.innerHeight + scrollTop + 300)) {
            const picture = card.querySelector('picture');
            if (picture) loadPicture(picture);
          }
        });
      };
      
      // Throttle para mejorar rendimiento
      let lazyLoadThrottleTimeout: ReturnType<typeof setTimeout> | undefined;
      const throttleLazyLoad = () => {
        if (lazyLoadThrottleTimeout) {
          clearTimeout(lazyLoadThrottleTimeout);
        }
        lazyLoadThrottleTimeout = setTimeout(lazyLoadFallback, 20);
      };
      
      (window as Window).addEventListener('scroll', throttleLazyLoad);
      (window as Window).addEventListener('resize', throttleLazyLoad);
      (window as Window).addEventListener('orientationchange', throttleLazyLoad);
      lazyLoadFallback();
    }
  };
  
  // Ejecutar cuando el DOM esté listo
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', lazyLoadImages);
  } else {
    lazyLoadImages();
  }
</script>

<style>
  /* Utilidad sutil para asegurar bordes redondeados sin afectar el diseño */
  .convenio__card picture, .convenio__card img { border-radius: 0.5rem; }

  /* Portfolio section styles */
  .section__img {
    margin-bottom: 2rem;
    font-size: 2rem;
    font-weight: 700;
    text-align: center;
  }

  .portfolio__grid {
  margin-top: 2rem;
  display: grid;
  gap: 2rem;
  grid-template-columns: repeat(5, 1fr);
  grid-template-rows: repeat(3, 1fr);
  max-width: 1350px;
  margin-left: auto;
  margin-right: auto;
  contain: layout style;
}

.convenio__card {
  overflow: hidden;
  border-radius: 1rem;
  box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.2);
  contain: content;
  aspect-ratio: 182/121;
}

.convenio__card img {
  transition: 0.5s;
  width: 100%;
  height: auto;
  object-fit: contain;
  will-change: transform;
}

.convenio__card:hover img {
  transform: scale(1.1);
}

.convenio__card picture {
  width: 100%;
  height: 100%;
  display: flex;
}

/* Optimización para lazy-load */
.lazy-img {
  opacity: 0;
  transition: opacity 0.3s;
}

.lazy-img[src] {
  opacity: 1;
}

  .portfolio__banner {
    margin-top: 3rem;
    padding: 2.5rem 2rem;
    display: grid;
    gap: 2rem;
    text-align: center;
    background-image: var(--gradient-2);
    border-radius: 1rem;
    box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.2);
  }

  .portfolio__banner__card {
    padding: 1rem;
  }

  .portfolio__banner__card span {
    display: inline-block;
    margin-bottom: 1rem;
    font-size: 2rem;
    color: #00aa44;
  }

  .portfolio__banner__card h4 {
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--white);
  }

  .portfolio__banner__card p {
    font-weight: 500;
    color: var(--extra-light);
    font-size: 16px;
  }

  /* Mobile styles */
  @media (max-width: 767px) {
    .portfolio__grid {
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: auto;
      gap: 1rem;
      max-width: 100%;
    }
  }

  /* Tablet styles */
  @media (min-width: 768px) and (max-width: 1023px) {
    .portfolio__grid {
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: auto;
      gap: 1.5rem;
    }

    .portfolio__banner {
      grid-template-columns: repeat(3, 1fr);
      padding: 3rem 2rem;
    }
  }

  /* Desktop styles - FIXED: 5 columnas fijas */
  @media (min-width: 1024px) {
    .section__img {
      font-size: 2.5rem;
    }

    .portfolio__grid {
      grid-template-columns: repeat(5, 1fr);
      grid-template-rows: auto;
      gap: 1.5rem;
    }

    .portfolio__banner {
      padding: 4rem 3rem;
      grid-template-columns: repeat(3, 1fr);
    }

    .portfolio__banner__card span { 
      font-size: 3rem; 
    }
    
    .portfolio__banner__card h4 { 
      font-size: 1.4rem; 
    }
    
    .portfolio__banner__card p { 
      font-size: 18px; 
    }
  }
</style>